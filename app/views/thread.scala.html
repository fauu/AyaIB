@(board: models.entities.Board, thread: models.entities.Thread, singleThreadView: Boolean = false)(implicit lang: Lang)

@import utils.Utils

@postHeader(post: models.entities.Post, isOp: Boolean) = {
  <header>
    @post.subject match {
      case Some(subject) => {
        <span class="subject">
          @subject
        </span> 路
      }
      case None => { }
    }
    <span class="poster-name">
      @defining(
        post.name match {
          case Some(name) => name
          case _ => Messages("anonymous")
        }
      ) { name =>
        @post.email match {
          case Some(email) => {
            <a href="mailto:@email">@name</a>
          }
          case _ => { @name }
        }
      }
    </span> 路
    <span class="date">
      @Utils.formatDate(post.date) 路
    </span>
    <a class="no" href="@routes.BoardController.showThread(board.name, thread.op.no)#post-@post.no">
      #@post.no
    </a>
    @if(isOp && !singleThreadView) {
      <a class="reply-link" href="@routes.BoardController.showThread(board.name, thread.op.no)">
        @Messages("thread.reply")
      </a>
    }
  </header>
}

@file(post: models.entities.Post) = {
  @defining(post.fileMetadata.get) { metadata =>
    <aside class="file-info">
      <a href="@routes.FileController.get(name = post.fileName.get, thumbnail = false)">@metadata.originalName</a>
      (@metadata.size 路 @metadata.dimensions)
    </aside>
  }
  <a href="@routes.FileController.get(name = post.fileName.get, thumbnail = false)">
    <img src="@routes.FileController.get(name = post.thumbnailName.get, thumbnail = true)" />
  </a>
}

<article class="thread">
  @postHeader(post = thread.op, isOp = true)
  @file(post = thread.op)
  @for(post <- thread.op :: thread.replies) {
    <article id="post-@post.no" class="post">
      @if(post != thread.op) { <aside class="indicator">>></aside> }
      <section class="body">
        @if(post != thread.op) {
          @postHeader(post, isOp = false)
          @post.fileMetadata match {
            case Some(metadata) => { @file(post) }
            case _ => { }
          }
        }
        <blockquote class="content">
          @Html(post.content)
        </blockquote>
      </section>
    </article>
  }
</article>
